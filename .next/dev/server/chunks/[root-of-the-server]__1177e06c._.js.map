{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/agent-portal-dashboard/lib/db.ts"],"sourcesContent":["import { Pool, Client } from \"pg\";\r\n\r\n// Environment variables\r\nconst DB_USER = process.env.PG_USER || \"postgres\";\r\nconst DB_PASSWORD = process.env.PG_PASSWORD || \"postgres12345\";\r\nconst DB_HOST = process.env.PG_HOST || \"localhost\";\r\nconst DB_PORT = Number(process.env.PG_PORT) || 5432;\r\nconst DB_NAME = process.env.PG_DATABASE || \"agent-portal\";\r\n\r\n// Function to create database if it doesn't exist\r\nasync function ensureDatabase() {\r\n  // Connect to default 'postgres' database first\r\n  const client = new Client({\r\n    user: DB_USER,\r\n    host: DB_HOST,\r\n    database: \"postgres\",\r\n    password: DB_PASSWORD,\r\n    port: DB_PORT,\r\n  });\r\n\r\n  try {\r\n    await client.connect();\r\n    console.log(\"Connected to PostgreSQL server...\");\r\n\r\n    // Check if the database exists\r\n    const res = await client.query(\r\n      \"SELECT 1 FROM pg_database WHERE datname = $1\",\r\n      [DB_NAME]\r\n    );\r\n\r\n    if (res.rowCount === 0) {\r\n      console.log(`Database \"${DB_NAME}\" does not exist. Creating...`);\r\n      await client.query(`CREATE DATABASE ${DB_NAME}`);\r\n      console.log(`Database \"${DB_NAME}\" created successfully.`);\r\n    } else {\r\n      console.log(`Database \"${DB_NAME}\" already exists.`);\r\n    }\r\n  } catch (err) {\r\n    console.error(\"Error checking/creating database:\", err);\r\n  } finally {\r\n    await client.end();\r\n  }\r\n}\r\n\r\n// Function to create table if it doesn't exist and seed initial data\r\nasync function ensureTable() {\r\n  const pool = new Pool({\r\n    user: DB_USER,\r\n    host: DB_HOST,\r\n    database: DB_NAME,\r\n    password: DB_PASSWORD,\r\n    port: DB_PORT,\r\n  });\r\n\r\n  try {\r\n    await pool.connect();\r\n    console.log(`Connected to database \"${DB_NAME}\"...`);\r\n\r\n    // Check if table exists\r\n    const tableRes = await pool.query(`\r\n      SELECT EXISTS (\r\n        SELECT FROM information_schema.tables \r\n        WHERE table_schema = 'public' AND table_name = 'workspaces'\r\n      )\r\n    `);\r\n\r\n    if (!tableRes.rows[0].exists) {\r\n      console.log(\"Table 'workspaces' does not exist. Creating...\");\r\n      await pool.query(`\r\n        CREATE TABLE workspaces (\r\n          id VARCHAR(50) PRIMARY KEY,\r\n          agent_name VARCHAR(100) NOT NULL,\r\n          status VARCHAR(20) NOT NULL DEFAULT 'active',\r\n          agent_status VARCHAR(20) DEFAULT 'offline',\r\n          created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\r\n        )\r\n      `);\r\n      console.log(\"Table 'workspaces' created successfully.\");\r\n\r\n      // Seed initial data\r\n      const initialData = [\r\n        { id: \"ws_1\", agent_name: \"Abdul basitt Ali\", status: \"active\", agent_status: \"online\" },\r\n        { id: \"ws_2\", agent_name: \"112222\", status: \"active\", agent_status: \"busy\" },\r\n        { id: \"ws_3\", agent_name: \"Innovatech Solutions\", status: \"suspended\", agent_status: \"offline\" },\r\n      ];\r\n\r\n      for (const ws of initialData) {\r\n        await pool.query(\r\n          \"INSERT INTO workspaces (id, agent_name, status, agent_status) VALUES ($1, $2, $3, $4)\",\r\n          [ws.id, ws.agent_name, ws.status, ws.agent_status]\r\n        );\r\n      }\r\n      console.log(\"Initial data seeded successfully.\");\r\n    } else {\r\n      console.log(\"Table 'workspaces' already exists.\");\r\n      // Check if agent_status column exists, if not add it\r\n      const columnRes = await pool.query(`\r\n        SELECT EXISTS (\r\n          SELECT FROM information_schema.columns \r\n          WHERE table_schema = 'public' AND table_name = 'workspaces' AND column_name = 'agent_status'\r\n        )\r\n      `);\r\n      \r\n      if (!columnRes.rows[0].exists) {\r\n        console.log(\"Adding 'agent_status' column to 'workspaces' table...\");\r\n        await pool.query(`\r\n          ALTER TABLE workspaces ADD COLUMN agent_status VARCHAR(20) DEFAULT 'offline'\r\n        `);\r\n        console.log(\"'agent_status' column added successfully.\");\r\n      }\r\n    }\r\n  } catch (err) {\r\n    console.error(\"Error checking/creating table or seeding data:\", err);\r\n  } finally {\r\n    await pool.end();\r\n  }\r\n}\r\n\r\n// Main function\r\nexport async function main() {\r\n  await ensureDatabase();\r\n  await ensureTable();\r\n  console.log(\"Database setup complete!\");\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,wBAAwB;AACxB,MAAM,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;AACvC,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW,IAAI;AAC/C,MAAM,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;AACvC,MAAM,UAAU,OAAO,QAAQ,GAAG,CAAC,OAAO,KAAK;AAC/C,MAAM,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;AAE3C,kDAAkD;AAClD,eAAe;IACb,+CAA+C;IAC/C,MAAM,SAAS,IAAI,8GAAM,CAAC;QACxB,MAAM;QACN,MAAM;QACN,UAAU;QACV,UAAU;QACV,MAAM;IACR;IAEA,IAAI;QACF,MAAM,OAAO,OAAO;QACpB,QAAQ,GAAG,CAAC;QAEZ,+BAA+B;QAC/B,MAAM,MAAM,MAAM,OAAO,KAAK,CAC5B,gDACA;YAAC;SAAQ;QAGX,IAAI,IAAI,QAAQ,KAAK,GAAG;YACtB,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,QAAQ,6BAA6B,CAAC;YAC/D,MAAM,OAAO,KAAK,CAAC,CAAC,gBAAgB,EAAE,SAAS;YAC/C,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,QAAQ,uBAAuB,CAAC;QAC3D,OAAO;YACL,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,QAAQ,iBAAiB,CAAC;QACrD;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,qCAAqC;IACrD,SAAU;QACR,MAAM,OAAO,GAAG;IAClB;AACF;AAEA,qEAAqE;AACrE,eAAe;IACb,MAAM,OAAO,IAAI,4GAAI,CAAC;QACpB,MAAM;QACN,MAAM;QACN,UAAU;QACV,UAAU;QACV,MAAM;IACR;IAEA,IAAI;QACF,MAAM,KAAK,OAAO;QAClB,QAAQ,GAAG,CAAC,CAAC,uBAAuB,EAAE,QAAQ,IAAI,CAAC;QAEnD,wBAAwB;QACxB,MAAM,WAAW,MAAM,KAAK,KAAK,CAAC,CAAC;;;;;IAKnC,CAAC;QAED,IAAI,CAAC,SAAS,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE;YAC5B,QAAQ,GAAG,CAAC;YACZ,MAAM,KAAK,KAAK,CAAC,CAAC;;;;;;;;MAQlB,CAAC;YACD,QAAQ,GAAG,CAAC;YAEZ,oBAAoB;YACpB,MAAM,cAAc;gBAClB;oBAAE,IAAI;oBAAQ,YAAY;oBAAoB,QAAQ;oBAAU,cAAc;gBAAS;gBACvF;oBAAE,IAAI;oBAAQ,YAAY;oBAAU,QAAQ;oBAAU,cAAc;gBAAO;gBAC3E;oBAAE,IAAI;oBAAQ,YAAY;oBAAwB,QAAQ;oBAAa,cAAc;gBAAU;aAChG;YAED,KAAK,MAAM,MAAM,YAAa;gBAC5B,MAAM,KAAK,KAAK,CACd,yFACA;oBAAC,GAAG,EAAE;oBAAE,GAAG,UAAU;oBAAE,GAAG,MAAM;oBAAE,GAAG,YAAY;iBAAC;YAEtD;YACA,QAAQ,GAAG,CAAC;QACd,OAAO;YACL,QAAQ,GAAG,CAAC;YACZ,qDAAqD;YACrD,MAAM,YAAY,MAAM,KAAK,KAAK,CAAC,CAAC;;;;;MAKpC,CAAC;YAED,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE,CAAC,MAAM,EAAE;gBAC7B,QAAQ,GAAG,CAAC;gBACZ,MAAM,KAAK,KAAK,CAAC,CAAC;;QAElB,CAAC;gBACD,QAAQ,GAAG,CAAC;YACd;QACF;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,kDAAkD;IAClE,SAAU;QACR,MAAM,KAAK,GAAG;IAChB;AACF;AAGO,eAAe;IACpB,MAAM;IACN,MAAM;IACN,QAAQ,GAAG,CAAC;AACd"}}]
}