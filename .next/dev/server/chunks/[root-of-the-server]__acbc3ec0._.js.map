{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/agent-portal-dashboard/lib/controllers/workspaceController.ts"],"sourcesContent":["import { Pool } from \"pg\";\r\n\r\n// Database connection\r\nconst pool = new Pool({\r\n  user: process.env.PG_USER || \"postgres\",\r\n  host: process.env.PG_HOST || \"localhost\",\r\n  database: process.env.PG_DATABASE || \"agent-portal\",\r\n  password: process.env.PG_PASSWORD || \"postgres12345\",\r\n  port: Number(process.env.PG_PORT) || 5432,\r\n});\r\n\r\n// Map actions to status\r\nconst statusMap: { [key: string]: string } = {\r\n  login: \"active\",\r\n  logout: \"suspended\",\r\n};\r\n\r\n// Map actions to agent_status\r\nconst agentStatusMap: { [key: string]: string } = {\r\n  ready: \"READY\",\r\n  pause: \"PAUSE\",\r\n  \"in-call\": \"IN-CALL\",\r\n};\r\n\r\n/**\r\n * Get all workspaces from the database\r\n */\r\nexport async function getAllWorkspaces() {\r\n  try {\r\n    const result = await pool.query(\r\n      \"SELECT id, agent_name as agent, status, agent_status as \\\"agentStatus\\\" FROM workspaces ORDER BY created_at DESC\"\r\n    );\r\n    console.log(\"Fetched workspaces:\", result.rows);\r\n    return {\r\n      success: true,\r\n      data: result.rows,\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error fetching workspaces:\", error);\r\n    return {\r\n      success: false,\r\n      error: \"Failed to fetch workspaces\",\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Update workspace status (login/logout)\r\n * When login: status -> \"active\", agent_status -> \"READY\"\r\n * When logout: status -> \"suspended\", agent_status -> \"PAUSE\"\r\n */\r\nexport async function updateWorkspaceStatus(\r\n  workspaceId: string,\r\n  action: \"login\" | \"logout\"\r\n) {\r\n  try {\r\n    if (!statusMap[action]) {\r\n      return {\r\n        success: false,\r\n        error: \"Invalid action\",\r\n      };\r\n    }\r\n\r\n    const newStatus = statusMap[action];\r\n    const autoAgentStatus = action === \"login\" ? \"READY\" : \"PAUSE\";\r\n\r\n    console.log(\r\n      `Updating workspace ${workspaceId} status to ${newStatus} and agent_status to ${autoAgentStatus}`\r\n    );\r\n\r\n    const result = await pool.query(\r\n      \"UPDATE workspaces SET status = $1, agent_status = $2 WHERE id = $3 RETURNING *\",\r\n      [newStatus, autoAgentStatus, workspaceId]\r\n    );\r\n\r\n    if (result.rowCount === 0) {\r\n      return {\r\n        success: false,\r\n        error: \"Workspace not found\",\r\n      };\r\n    }\r\n\r\n    return {\r\n      success: true,\r\n      message: \"Workspace updated successfully\",\r\n      data: result.rows[0],\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error updating workspace status:\", error);\r\n    return {\r\n      success: false,\r\n      error: \"Failed to update workspace\",\r\n    };\r\n  }\r\n}\r\n\r\n/**\r\n * Update workspace agent status (READY/PAUSE/IN-CALL)\r\n * Only allows change if workspace status is \"active\" (logged in)\r\n */\r\nexport async function updateWorkspaceAgentStatus(\r\n  workspaceId: string,\r\n  action: \"ready\" | \"pause\" | \"in-call\"\r\n) {\r\n  try {\r\n    if (!agentStatusMap[action]) {\r\n      return {\r\n        success: false,\r\n        error: \"Invalid action\",\r\n      };\r\n    }\r\n\r\n    // Check if user is logged in before allowing agent_status change\r\n    const workspace = await pool.query(\r\n      \"SELECT status FROM workspaces WHERE id = $1\",\r\n      [workspaceId]\r\n    );\r\n\r\n    if (workspace.rowCount === 0) {\r\n      return {\r\n        success: false,\r\n        error: \"Workspace not found\",\r\n      };\r\n    }\r\n\r\n    const currentStatus = workspace.rows[0].status;\r\n\r\n    // Only allow agent_status change if status is \"active\" (logged in)\r\n    if (currentStatus !== \"active\") {\r\n      return {\r\n        success: false,\r\n        error: \"Cannot change agent status when user is not logged in\",\r\n      };\r\n    }\r\n\r\n    const newAgentStatus = agentStatusMap[action];\r\n    console.log(`Updating workspace ${workspaceId} agent_status to ${newAgentStatus}`);\r\n\r\n    const result = await pool.query(\r\n      \"UPDATE workspaces SET agent_status = $1 WHERE id = $2 RETURNING *\",\r\n      [newAgentStatus, workspaceId]\r\n    );\r\n\r\n    if (result.rowCount === 0) {\r\n      return {\r\n        success: false,\r\n        error: \"Workspace not found\",\r\n      };\r\n    }\r\n\r\n    console.log(\"Updated workspace:\", result.rows[0]);\r\n    return {\r\n      success: true,\r\n      message: \"Agent status updated successfully\",\r\n      data: result.rows[0],\r\n    };\r\n  } catch (error) {\r\n    console.error(\"Error updating workspace agent status:\", error);\r\n    return {\r\n      success: false,\r\n      error: \"Failed to update workspace\",\r\n    };\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;;;;;AAEA,sBAAsB;AACtB,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,MAAM,OAAO,QAAQ,GAAG,CAAC,OAAO,KAAK;AACvC;AAEA,wBAAwB;AACxB,MAAM,YAAuC;IAC3C,OAAO;IACP,QAAQ;AACV;AAEA,8BAA8B;AAC9B,MAAM,iBAA4C;IAChD,OAAO;IACP,OAAO;IACP,WAAW;AACb;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,SAAS,MAAM,KAAK,KAAK,CAC7B;QAEF,QAAQ,GAAG,CAAC,uBAAuB,OAAO,IAAI;QAC9C,OAAO;YACL,SAAS;YACT,MAAM,OAAO,IAAI;QACnB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF;AAOO,eAAe,sBACpB,WAAmB,EACnB,MAA0B;IAE1B,IAAI;QACF,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE;YACtB,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,MAAM,YAAY,SAAS,CAAC,OAAO;QACnC,MAAM,kBAAkB,WAAW,UAAU,UAAU;QAEvD,QAAQ,GAAG,CACT,CAAC,mBAAmB,EAAE,YAAY,WAAW,EAAE,UAAU,qBAAqB,EAAE,iBAAiB;QAGnG,MAAM,SAAS,MAAM,KAAK,KAAK,CAC7B,kFACA;YAAC;YAAW;YAAiB;SAAY;QAG3C,IAAI,OAAO,QAAQ,KAAK,GAAG;YACzB,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,OAAO;YACL,SAAS;YACT,SAAS;YACT,MAAM,OAAO,IAAI,CAAC,EAAE;QACtB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF;AAMO,eAAe,2BACpB,WAAmB,EACnB,MAAqC;IAErC,IAAI;QACF,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE;YAC3B,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,iEAAiE;QACjE,MAAM,YAAY,MAAM,KAAK,KAAK,CAChC,+CACA;YAAC;SAAY;QAGf,IAAI,UAAU,QAAQ,KAAK,GAAG;YAC5B,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,MAAM,gBAAgB,UAAU,IAAI,CAAC,EAAE,CAAC,MAAM;QAE9C,mEAAmE;QACnE,IAAI,kBAAkB,UAAU;YAC9B,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,MAAM,iBAAiB,cAAc,CAAC,OAAO;QAC7C,QAAQ,GAAG,CAAC,CAAC,mBAAmB,EAAE,YAAY,iBAAiB,EAAE,gBAAgB;QAEjF,MAAM,SAAS,MAAM,KAAK,KAAK,CAC7B,qEACA;YAAC;YAAgB;SAAY;QAG/B,IAAI,OAAO,QAAQ,KAAK,GAAG;YACzB,OAAO;gBACL,SAAS;gBACT,OAAO;YACT;QACF;QAEA,QAAQ,GAAG,CAAC,sBAAsB,OAAO,IAAI,CAAC,EAAE;QAChD,OAAO;YACL,SAAS;YACT,SAAS;YACT,MAAM,OAAO,IAAI,CAAC,EAAE;QACtB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0CAA0C;QACxD,OAAO;YACL,SAAS;YACT,OAAO;QACT;IACF;AACF"}},
    {"offset": {"line": 201, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/User/Desktop/agent-portal-dashboard/app/api/workspaces/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport {\r\n  getAllWorkspaces,\r\n  updateWorkspaceStatus,\r\n  updateWorkspaceAgentStatus,\r\n} from \"@/lib/controllers/workspaceController\";\r\n\r\n// GET all workspaces\r\nexport async function GET(request: NextRequest) {\r\n  const result = await getAllWorkspaces();\r\n\r\n  if (!result.success) {\r\n    return NextResponse.json({ error: result.error }, { status: 500 });\r\n  }\r\n\r\n  return NextResponse.json({ workspaces: result.data });\r\n}\r\n\r\n// POST to update a workspace\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const { workspaceId, action } = await request.json();\r\n\r\n    if (!workspaceId || !action) {\r\n      return NextResponse.json(\r\n        { error: \"Missing workspaceId or action\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n\r\n    // Handle login/logout actions\r\n    if (action === \"login\" || action === \"logout\") {\r\n      const result = await updateWorkspaceStatus(workspaceId, action);\r\n\r\n      if (!result.success) {\r\n        const statusCode =\r\n          result.error === \"Workspace not found\" ? 404 : 400;\r\n        return NextResponse.json({ error: result.error }, { status: statusCode });\r\n      }\r\n\r\n      return NextResponse.json({\r\n        message: result.message,\r\n        workspace: result.data,\r\n      });\r\n    }\r\n    // Handle ready/pause/in-call actions\r\n    else if (action === \"ready\" || action === \"pause\" || action === \"in-call\") {\r\n      const result = await updateWorkspaceAgentStatus(workspaceId, action);\r\n\r\n      if (!result.success) {\r\n        const statusCode =\r\n          result.error === \"Workspace not found\" ? 404 : 400;\r\n        return NextResponse.json({ error: result.error }, { status: statusCode });\r\n      }\r\n\r\n      return NextResponse.json({\r\n        message: result.message,\r\n        workspace: result.data,\r\n      });\r\n    } else {\r\n      return NextResponse.json(\r\n        { error: \"Invalid action\" },\r\n        { status: 400 }\r\n      );\r\n    }\r\n  } catch (error) {\r\n    console.error(\"Error processing request:\", error);\r\n    return NextResponse.json(\r\n      { error: \"Failed to process request\" },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;AAOO,eAAe,IAAI,OAAoB;IAC5C,MAAM,SAAS,MAAM,IAAA,0MAAgB;IAErC,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,OAAO,2LAAY,CAAC,IAAI,CAAC;YAAE,OAAO,OAAO,KAAK;QAAC,GAAG;YAAE,QAAQ;QAAI;IAClE;IAEA,OAAO,2LAAY,CAAC,IAAI,CAAC;QAAE,YAAY,OAAO,IAAI;IAAC;AACrD;AAGO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,EAAE,WAAW,EAAE,MAAM,EAAE,GAAG,MAAM,QAAQ,IAAI;QAElD,IAAI,CAAC,eAAe,CAAC,QAAQ;YAC3B,OAAO,2LAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,8BAA8B;QAC9B,IAAI,WAAW,WAAW,WAAW,UAAU;YAC7C,MAAM,SAAS,MAAM,IAAA,+MAAqB,EAAC,aAAa;YAExD,IAAI,CAAC,OAAO,OAAO,EAAE;gBACnB,MAAM,aACJ,OAAO,KAAK,KAAK,wBAAwB,MAAM;gBACjD,OAAO,2LAAY,CAAC,IAAI,CAAC;oBAAE,OAAO,OAAO,KAAK;gBAAC,GAAG;oBAAE,QAAQ;gBAAW;YACzE;YAEA,OAAO,2LAAY,CAAC,IAAI,CAAC;gBACvB,SAAS,OAAO,OAAO;gBACvB,WAAW,OAAO,IAAI;YACxB;QACF,OAEK,IAAI,WAAW,WAAW,WAAW,WAAW,WAAW,WAAW;YACzE,MAAM,SAAS,MAAM,IAAA,oNAA0B,EAAC,aAAa;YAE7D,IAAI,CAAC,OAAO,OAAO,EAAE;gBACnB,MAAM,aACJ,OAAO,KAAK,KAAK,wBAAwB,MAAM;gBACjD,OAAO,2LAAY,CAAC,IAAI,CAAC;oBAAE,OAAO,OAAO,KAAK;gBAAC,GAAG;oBAAE,QAAQ;gBAAW;YACzE;YAEA,OAAO,2LAAY,CAAC,IAAI,CAAC;gBACvB,SAAS,OAAO,OAAO;gBACvB,WAAW,OAAO,IAAI;YACxB;QACF,OAAO;YACL,OAAO,2LAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiB,GAC1B;gBAAE,QAAQ;YAAI;QAElB;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,2LAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAA4B,GACrC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}